{% extends "base.html" %}

{% block title %}Patient Intake Form - Healthcare Clinic{% endblock %}

{% block content %}
<div class="form-header">
    <h2>Patient Intake Form</h2>
    <p class="mb-0">Healthcare Clinic</p>
    <small>Please fill out all sections completely</small>
</div>

<div class="form-body">
    <div class="security-notice">
        <strong>üîí Secure Medical Form:</strong> This form is encrypted and HIPAA-compliant. 
        All information is transmitted securely to the clinic.
    </div>

    <div class="progress-indicator">
        <div class="progress-bar" style="width: 0%" id="progressBar"></div>
    </div>

    <form method="POST" action="{{ url_for('submit_patient_intake', token=token) }}" id="intakeForm" novalidate>
        {{ form.hidden_tag() }}
        
        <!-- Basic Information Section -->
        <div class="section-title">üë§ Basic Information</div>
        <div class="row">
            <div class="col-md-6 mb-3">
                {{ form.first_name.label(class="form-label required") }}
                {{ form.first_name(class="form-control" + (" is-invalid" if form.first_name.errors else "")) }}
                {% for error in form.first_name.errors %}
                    <div class="invalid-feedback">{{ error }}</div>
                {% endfor %}
            </div>
            <div class="col-md-6 mb-3">
                {{ form.last_name.label(class="form-label required") }}
                {{ form.last_name(class="form-control" + (" is-invalid" if form.last_name.errors else "")) }}
                {% for error in form.last_name.errors %}
                    <div class="invalid-feedback">{{ error }}</div>
                {% endfor %}
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-6 mb-3">
                {{ form.date_of_birth.label(class="form-label required") }}
                {{ form.date_of_birth(class="form-control" + (" is-invalid" if form.date_of_birth.errors else "")) }}
                {% for error in form.date_of_birth.errors %}
                    <div class="invalid-feedback">{{ error }}</div>
                {% endfor %}
            </div>
            <div class="col-md-6 mb-3">
                {{ form.phone.label(class="form-label required") }}
                {{ form.phone(class="form-control" + (" is-invalid" if form.phone.errors else "")) }}
                {% for error in form.phone.errors %}
                    <div class="invalid-feedback">{{ error }}</div>
                {% endfor %}
            </div>
        </div>
        
        <div class="mb-3">
            {{ form.email.label(class="form-label") }}
            {{ form.email(class="form-control" + (" is-invalid" if form.email.errors else "")) }}
            {% for error in form.email.errors %}
                <div class="invalid-feedback">{{ error }}</div>
            {% endfor %}
        </div>

        <!-- Address Section -->
        <div class="section-title">üè† Address Information</div>
        <div class="mb-3">
            {{ form.street_address.label(class="form-label required") }}
            {{ form.street_address(class="form-control" + (" is-invalid" if form.street_address.errors else "")) }}
            {% for error in form.street_address.errors %}
                <div class="invalid-feedback">{{ error }}</div>
            {% endfor %}
        </div>
        
        <div class="row">
            <div class="col-md-4 mb-3">
                {{ form.city.label(class="form-label required") }}
                {{ form.city(class="form-control" + (" is-invalid" if form.city.errors else "")) }}
                {% for error in form.city.errors %}
                    <div class="invalid-feedback">{{ error }}</div>
                {% endfor %}
            </div>
            <div class="col-md-4 mb-3">
                {{ form.state.label(class="form-label required") }}
                {{ form.state(class="form-select" + (" is-invalid" if form.state.errors else "")) }}
                {% for error in form.state.errors %}
                    <div class="invalid-feedback">{{ error }}</div>
                {% endfor %}
            </div>
            <div class="col-md-4 mb-3">
                {{ form.zip_code.label(class="form-label required") }}
                {{ form.zip_code(class="form-control" + (" is-invalid" if form.zip_code.errors else "")) }}
                {% for error in form.zip_code.errors %}
                    <div class="invalid-feedback">{{ error }}</div>
                {% endfor %}
            </div>
        </div>

        <!-- Emergency Contact Section -->
        <div class="section-title">üö® Emergency Contact</div>
        <div class="row">
            <div class="col-md-6 mb-3">
                {{ form.emergency_contact_name.label(class="form-label required") }}
                {{ form.emergency_contact_name(class="form-control" + (" is-invalid" if form.emergency_contact_name.errors else "")) }}
                {% for error in form.emergency_contact_name.errors %}
                    <div class="invalid-feedback">{{ error }}</div>
                {% endfor %}
            </div>
            <div class="col-md-6 mb-3">
                {{ form.emergency_contact_phone.label(class="form-label required") }}
                {{ form.emergency_contact_phone(class="form-control" + (" is-invalid" if form.emergency_contact_phone.errors else "")) }}
                {% for error in form.emergency_contact_phone.errors %}
                    <div class="invalid-feedback">{{ error }}</div>
                {% endfor %}
            </div>
        </div>
        
        <div class="mb-3">
            {{ form.emergency_contact_relationship.label(class="form-label required") }}
            {{ form.emergency_contact_relationship(class="form-control" + (" is-invalid" if form.emergency_contact_relationship.errors else "")) }}
            {% for error in form.emergency_contact_relationship.errors %}
                <div class="invalid-feedback">{{ error }}</div>
            {% endfor %}
        </div>

        <!-- Medical Information Section -->
        <div class="section-title">üè• Medical Information</div>
        <div class="row">
            <div class="col-md-6 mb-3">
                {{ form.insurance_provider.label(class="form-label") }}
                {{ form.insurance_provider(class="form-control" + (" is-invalid" if form.insurance_provider.errors else "")) }}
                {% for error in form.insurance_provider.errors %}
                    <div class="invalid-feedback">{{ error }}</div>
                {% endfor %}
            </div>
            <div class="col-md-6 mb-3">
                {{ form.insurance_id.label(class="form-label") }}
                {{ form.insurance_id(class="form-control" + (" is-invalid" if form.insurance_id.errors else "")) }}
                {% for error in form.insurance_id.errors %}
                    <div class="invalid-feedback">{{ error }}</div>
                {% endfor %}
            </div>
        </div>
        
        <div class="mb-3">
            {{ form.primary_physician.label(class="form-label") }}
            {{ form.primary_physician(class="form-control" + (" is-invalid" if form.primary_physician.errors else "")) }}
            {% for error in form.primary_physician.errors %}
                <div class="invalid-feedback">{{ error }}</div>
            {% endfor %}
        </div>

        <!-- Current Visit Section -->
        <div class="section-title">üìã Current Visit Information</div>
        <div class="mb-3">
            {{ form.reason_for_visit.label(class="form-label required") }}
            {{ form.reason_for_visit(class="form-control" + (" is-invalid" if form.reason_for_visit.errors else ""), rows="3") }}
            {% for error in form.reason_for_visit.errors %}
                <div class="invalid-feedback">{{ error }}</div>
            {% endfor %}
        </div>
        
        <div class="mb-3">
            {{ form.current_medications.label(class="form-label") }}
            {{ form.current_medications(class="form-control" + (" is-invalid" if form.current_medications.errors else ""), rows="3") }}
            {% for error in form.current_medications.errors %}
                <div class="invalid-feedback">{{ error }}</div>
            {% endfor %}
        </div>
        
        <div class="mb-3">
            {{ form.allergies.label(class="form-label") }}
            {{ form.allergies(class="form-control" + (" is-invalid" if form.allergies.errors else ""), rows="2") }}
            {% for error in form.allergies.errors %}
                <div class="invalid-feedback">{{ error }}</div>
            {% endfor %}
        </div>
        
        <div class="mb-4">
            {{ form.medical_history.label(class="form-label") }}
            {{ form.medical_history(class="form-control" + (" is-invalid" if form.medical_history.errors else ""), rows="3") }}
            {% for error in form.medical_history.errors %}
                <div class="invalid-feedback">{{ error }}</div>
            {% endfor %}
        </div>

        <button type="submit" class="btn btn-primary">Submit Form</button>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Progress bar functionality
    const form = document.getElementById('intakeForm');
    const progressBar = document.getElementById('progressBar');
    const requiredFields = form.querySelectorAll('[required]');
    
    function updateProgress() {
        let completed = 0;
        requiredFields.forEach(field => {
            if (field.value.trim() !== '') {
                completed++;
            }
        });
        const progress = (completed / requiredFields.length) * 100;
        progressBar.style.width = progress + '%';
    }
    
    // Update progress on input
    form.addEventListener('input', updateProgress);
    
    // Initial progress calculation
    updateProgress();
});
</script>
{% endblock %}
